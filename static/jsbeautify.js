/*jslint onevar: false, plusplus: false *//*jshint curly:true, eqeqeq:true, laxbreak:true, noempty:false *//*

 JS Beautifier
---------------


  Written by Einar Lielmanis, <einar@jsbeautifier.org>
      http://jsbeautifier.org/

  Originally converted to javascript by Vital, <vital76@gmail.com>
  "End braces on own line" added by Chris J. Shull, <chrisjshull@gmail.com>

  You are free to use this in any way you want, in case you find this useful or working for you.

  Usage:
    js_beautify(js_source_text);
    js_beautify(js_source_text, options);

  The options are:
    indent_size (default 4)          - indentation size,
    indent_char (default space)      - character to indent with,
    preserve_newlines (default true) - whether existing line breaks should be preserved,
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk,

    jslint_happy (default false) - if true, then jslint-stricter mode is enforced.

            jslint_happy   !jslint_happy
            ---------------------------------
             function ()      function()

    brace_style (default "collapse") - "collapse" | "expand" | "end-expand" | "expand-strict"
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line.

            expand-strict: put brace on own line even in such cases:

                var a =
                {
                    a: 5,
                    b: 6
                }
            This mode may break your scripts - e.g "return { a: 1 }" will be broken into two lines, so beware.

    space_before_conditional (default true) - should the space before conditional statement be added, "if(true)" vs "if (true)",

    unescape_strings (default false) - should printable characters in strings encoded in \xNN notation be unescaped, "example" vs "\x65\x78\x61\x6d\x70\x6c\x65"

    e.g

    js_beautify(js_source_text, {
      'indent_size': 1,
      'indent_char': '\t'
    });


*/function js_beautify(e,t){function B(e){e=typeof e=="undefined"?!1:e;while(r.length&&(r[r.length-1]===" "||r[r.length-1]===c||r[r.length-1]===T||e&&(r[r.length-1]==="\n"||r[r.length-1]==="\r")))r.pop()}function j(e){return e.replace(/^\s\s*|\s\s*$/,"")}function F(e){e=e.replace(/\x0d/g,"");var t=[],n=e.indexOf("\n");while(n!==-1)t.push(e.substring(0,n)),e=e.substring(n+1),n=e.indexOf("\n");return e.length&&t.push(e),t}function I(){var e=M;M=!1,q(),M=e}function q(e){f.eat_next_space=!1;if(M&&V(f.mode))return;e=typeof e=="undefined"?!0:e,f.if_line=!1,B();if(!r.length)return;if(r[r.length-1]!=="\n"||!e)S=!0,r.push("\n");T&&r.push(T);for(var t=0;t<f.indentation_level;t+=1)r.push(c);f.var_line&&f.var_line_reindented&&r.push(c),f.case_body&&r.push(c)}function R(){if(s==="TK_COMMENT")return q();if(f.eat_next_space){f.eat_next_space=!1;return}var e=" ";r.length&&(e=r[r.length-1]),e!==" "&&e!=="\n"&&e!==c&&r.push(" ")}function U(){S=!1,f.eat_next_space=!1,r.push(i)}function z(){f.indentation_level+=1}function W(){r.length&&r[r.length-1]===c&&r.pop()}function X(e){f&&l.push(f),f={previous_mode:f?f.mode:"BLOCK",mode:e,var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,if_line:!1,in_case_statement:!1,in_case:!1,case_body:!1,eat_next_space:!1,indentation_baseline:-1,indentation_level:f?f.indentation_level+(f.case_body?1:0)+(f.var_line&&f.var_line_reindented?1:0):0,ternary_depth:0}}function V(e){return e==="[EXPRESSION]"||e==="[INDENTED-EXPRESSION]"}function $(e){return G(e,["[EXPRESSION]","(EXPRESSION)","(FOR-EXPRESSION)","(COND-EXPRESSION)"])}function J(){w=f.mode==="DO_BLOCK";if(l.length>0){var e=f.mode;f=l.pop(),f.previous_mode=e}}function K(e,t){for(var n=0;n<e.length;n++){var r=j(e[n]);if(r.charAt(0)!==t)return!1}return!0}function Q(e){return G(e,["case","return","do","if","throw","else"])}function G(e,t){for(var n=0;n<t.length;n+=1)if(t[n]===e)return!0;return!1}function Y(e){var t=v,r=n.charAt(t);while(G(r,h)&&r!==e){t++;if(t>=H)return 0;r=n.charAt(t)}return r}function Z(){var e,t;x=0;if(v>=H)return["","TK_EOF"];E=!1;var i=n.charAt(v);v+=1;var u=M&&V(f.mode);if(u){var a=0;while(G(i,h)){i==="\n"?(B(),r.push("\n"),S=!0,a=0):i===" "?a+=4:i!=="\r"&&(a+=1);if(v>=H)return["","TK_EOF"];i=n.charAt(v),v+=1}f.indentation_baseline===-1&&(f.indentation_baseline=a);if(S){for(e=0;e<f.indentation_level+1;e+=1)r.push(c);if(f.indentation_baseline!==-1)for(e=0;e<a-f.indentation_baseline;e++)r.push(" ")}}else{while(G(i,h)){i==="\n"&&(x+=A?x<=A?1:0:1);if(v>=H)return["","TK_EOF"];i=n.charAt(v),v+=1}if(L&&x>1)for(e=0;e<x;e+=1)q(e===0),S=!0;E=x>0}if(G(i,p)){if(v<H)while(G(n.charAt(v),p)){i+=n.charAt(v),v+=1;if(v===H)break}if(v===H||!i.match(/^[0-9]+[Ee]$/)||n.charAt(v)!=="-"&&n.charAt(v)!=="+")return i==="in"?[i,"TK_OPERATOR"]:(E&&s!=="TK_OPERATOR"&&s!=="TK_EQUALS"&&!f.if_line&&(L||o!=="var")&&q(),[i,"TK_WORD"]);var l=n.charAt(v);v+=1;var m=Z();return i+=l+m[0],[i,"TK_WORD"]}if(i==="("||i==="[")return[i,"TK_START_EXPR"];if(i===")"||i==="]")return[i,"TK_END_EXPR"];if(i==="{")return[i,"TK_START_BLOCK"];if(i==="}")return[i,"TK_END_BLOCK"];if(i===";")return[i,"TK_SEMICOLON"];if(i==="/"){var y="",b=!0;if(n.charAt(v)==="*"){v+=1;if(v<H)while(v<H&&(n.charAt(v)!=="*"||!n.charAt(v+1)||n.charAt(v+1)!=="/")){i=n.charAt(v),y+=i;if(i==="\n"||i==="\r")b=!1;v+=1;if(v>=H)break}return v+=2,b&&x===0?["/*"+y+"*/","TK_INLINE_COMMENT"]:["/*"+y+"*/","TK_BLOCK_COMMENT"]}if(n.charAt(v)==="/"){y=i;while(n.charAt(v)!=="\r"&&n.charAt(v)!=="\n"){y+=n.charAt(v),v+=1;if(v>=H)break}return E&&q(),[y,"TK_COMMENT"]}}if(i==="'"||i==='"'||i==="/"&&(s==="TK_WORD"&&Q(o)||o===")"&&G(f.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])||s==="TK_COMMA"||s==="TK_COMMENT"||s==="TK_START_EXPR"||s==="TK_START_BLOCK"||s==="TK_END_BLOCK"||s==="TK_OPERATOR"||s==="TK_EQUALS"||s==="TK_EOF"||s==="TK_SEMICOLON")){var w=i,T=!1,N=0,C=0;t=i;if(v<H)if(w==="/"){var k=!1;while(T||k||n.charAt(v)!==w){t+=n.charAt(v),T?T=!1:(T=n.charAt(v)==="\\",n.charAt(v)==="["?k=!0:n.charAt(v)==="]"&&(k=!1)),v+=1;if(v>=H)return[t,"TK_STRING"]}}else while(T||n.charAt(v)!==w){t+=n.charAt(v),N&&N>=C&&(N=parseInt(t.substr(-C),16),N&&N>=32&&N<=126&&(N=String.fromCharCode(N),t=t.substr(0,t.length-C-2)+(N===w||N==="\\"?"\\":"")+N),N=0),N?N++:T?(T=!1,P&&(n.charAt(v)==="x"?(N++,C=2):n.charAt(v)==="u"&&(N++,C=4))):T=n.charAt(v)==="\\",v+=1;if(v>=H)return[t,"TK_STRING"]}v+=1,t+=w;if(w==="/")while(v<H&&G(n.charAt(v),p))t+=n.charAt(v),v+=1;return[t,"TK_STRING"]}if(i==="#"){if(r.length===0&&n.charAt(v)==="!"){t=i;while(v<H&&i!=="\n")i=n.charAt(v),t+=i,v+=1;return r.push(j(t)+"\n"),q(),Z()}var O="#";if(v<H&&G(n.charAt(v),g)){do i=n.charAt(v),O+=i,v+=1;while(v<H&&i!=="#"&&i!=="=");return i!=="#"&&(n.charAt(v)==="["&&n.charAt(v+1)==="]"?(O+="[]",v+=2):n.charAt(v)==="{"&&n.charAt(v+1)==="}"&&(O+="{}",v+=2)),[O,"TK_WORD"]}}if(i==="<"&&n.substring(v-1,v+3)==="<!--"){v+=3,i="<!--";while(n.charAt(v)!=="\n"&&v<H)i+=n.charAt(v),v++;return f.in_html_comment=!0,[i,"TK_COMMENT"]}if(i==="-"&&f.in_html_comment&&n.substring(v-1,v+2)==="-->")return f.in_html_comment=!1,v+=2,E&&q(),["-->","TK_COMMENT"];if(G(i,d)){while(v<H&&G(i+n.charAt(v),d)){i+=n.charAt(v),v+=1;if(v>=H)break}return i===","?[i,"TK_COMMA"]:i==="="?[i,"TK_EQUALS"]:[i,"TK_OPERATOR"]}return[i,"TK_UNKNOWN"]}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T="";t=t?t:{};var N;t.space_after_anon_function!==undefined&&t.jslint_happy===undefined&&(t.jslint_happy=t.space_after_anon_function),t.braces_on_own_line!==undefined&&(N=t.braces_on_own_line?"expand":"collapse"),N=t.brace_style?t.brace_style:N?N:"collapse";var C=t.indent_size?t.indent_size:4,k=t.indent_char?t.indent_char:" ",L=typeof t.preserve_newlines=="undefined"?!0:t.preserve_newlines,A=typeof t.max_preserve_newlines=="undefined"?!1:t.max_preserve_newlines,O=t.jslint_happy==="undefined"?!1:t.jslint_happy,M=typeof t.keep_array_indentation=="undefined"?!1:t.keep_array_indentation,_=typeof t.space_before_conditional=="undefined"?!0:t.space_before_conditional,D=typeof t.indent_case=="undefined"?!1:t.indent_case,P=typeof t.unescape_strings=="undefined"?!1:t.unescape_strings;S=!1;var H=e.length;c="";while(C>0)c+=k,C-=1;while(e&&(e.charAt(0)===" "||e.charAt(0)==="  "))T+=e.charAt(0),e=e.substring(1);n=e,a="",s="TK_START_EXPR",o="",u="",r=[],w=!1,h="\n\r    ".split(""),p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),g="0123456789".split(""),d="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::",d+=" <%= <% %> <?= <? ?>",d=d.split(" "),m="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(","),l=[],X("BLOCK"),v=0;for(;;){var et=Z();i=et[0],b=et[1];if(b==="TK_EOF")break;switch(b){case"TK_START_EXPR":if(i==="["){if(s==="TK_WORD"||o===")"){G(o,m)&&R(),X("(EXPRESSION)"),U();break}f.mode==="[EXPRESSION]"||f.mode==="[INDENTED-EXPRESSION]"?u==="]"&&o===","?(f.mode==="[EXPRESSION]"&&(f.mode="[INDENTED-EXPRESSION]",M||z()),X("[EXPRESSION]"),M||q()):o==="["?(f.mode==="[EXPRESSION]"&&(f.mode="[INDENTED-EXPRESSION]",M||z()),X("[EXPRESSION]"),M||q()):X("[EXPRESSION]"):X("[EXPRESSION]")}else a==="for"?X("(FOR-EXPRESSION)"):G(a,["if","while"])?X("(COND-EXPRESSION)"):X("(EXPRESSION)");o===";"||s==="TK_START_BLOCK"?q():s==="TK_END_EXPR"||s==="TK_START_EXPR"||s==="TK_END_BLOCK"||o==="."?E&&q():s!=="TK_WORD"&&s!=="TK_OPERATOR"?R():a==="function"||a==="typeof"?O&&R():(G(o,m)||o==="catch")&&_&&R(),U();break;case"TK_END_EXPR":if(i==="]")if(M){if(o==="}"){W(),U(),J();break}}else if(f.mode==="[INDENTED-EXPRESSION]"&&o==="]"){J(),q(),U();break}J(),U();break;case"TK_START_BLOCK":a==="do"?X("DO_BLOCK"):X("BLOCK");if(N==="expand"||N==="expand-strict"){var tt=!1;N==="expand-strict"?(tt=Y()==="}",tt||q(!0)):s!=="TK_OPERATOR"&&(o==="="||Q(o)&&o!=="else"?R():q(!0)),U(),tt||z()}else s!=="TK_OPERATOR"&&s!=="TK_START_EXPR"?s==="TK_START_BLOCK"?q():R():V(f.previous_mode)&&o===","&&(u==="}"?R():q()),z(),U();break;case"TK_END_BLOCK":J(),N==="expand"||N==="expand-strict"?(o!=="{"&&q(),U()):(s==="TK_START_BLOCK"?S?W():B():V(f.mode)&&M?(M=!1,q(),M=!0):q(),U());break;case"TK_WORD":if(w){R(),U(),R(),w=!1;break}y="NONE";if(i==="function"){f.var_line&&s!=="TK_EQUALS"&&(f.var_line_reindented=!0);if((S||o===";")&&o!=="{"&&s!=="TK_BLOCK_COMMENT"&&s!=="TK_COMMENT"){x=S?x:0,L||(x=1);for(var nt=0;nt<2-x;nt++)q(!1)}s==="TK_WORD"?o==="get"||o==="set"||o==="new"||o==="return"?R():q():s==="TK_OPERATOR"||o==="="?R():$(f.mode)||q(),U(),a=i;break}if(i==="case"||i==="default"&&f.in_case_statement){o===":"||f.case_body?W():(D||f.indentation_level--,q(),D||f.indentation_level++),U(),f.in_case=!0,f.in_case_statement=!0,f.case_body=!1;break}s==="TK_END_BLOCK"?G(i.toLowerCase(),["else","catch","finally"])?N==="expand"||N==="end-expand"||N==="expand-strict"?y="NEWLINE":(y="SPACE",R()):y="NEWLINE":s!=="TK_SEMICOLON"||f.mode!=="BLOCK"&&f.mode!=="DO_BLOCK"?s==="TK_SEMICOLON"&&$(f.mode)?y="SPACE":s==="TK_STRING"?y="NEWLINE":s==="TK_WORD"?(o==="else"&&B(!0),y="SPACE"):s==="TK_START_BLOCK"?y="NEWLINE":s==="TK_END_EXPR"&&(R(),y="NEWLINE"):y="NEWLINE",G(i,m)&&o!==")"&&(o==="else"?y="SPACE":y="NEWLINE"),f.if_line&&s==="TK_END_EXPR"&&(f.if_line=!1),G(i.toLowerCase(),["else","catch","finally"])?s!=="TK_END_BLOCK"||N==="expand"||N==="end-expand"||N==="expand-strict"?q():(B(!0),R()):y==="NEWLINE"?Q(o)?R():s!=="TK_END_EXPR"?(s!=="TK_START_EXPR"||i!=="var")&&o!==":"&&(i==="if"&&a==="else"&&o!=="{"?R():(f.var_line=!1,f.var_line_reindented=!1,q())):G(i,m)&&o!==")"&&(f.var_line=!1,f.var_line_reindented=!1,q()):V(f.mode)&&o===","&&u==="}"?q():y==="SPACE"&&R(),U(),a=i,i==="var"&&(f.var_line=!0,f.var_line_reindented=!1,f.var_line_tainted=!1),i==="if"&&(f.if_line=!0),i==="else"&&(f.if_line=!1);break;case"TK_SEMICOLON":U(),f.var_line=!1,f.var_line_reindented=!1,f.mode==="OBJECT"&&(f.mode="BLOCK");break;case"TK_STRING":s==="TK_END_EXPR"&&G(f.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])?R():s==="TK_COMMENT"||s==="TK_STRING"||s==="TK_START_BLOCK"||s==="TK_END_BLOCK"||s==="TK_SEMICOLON"?q():s==="TK_WORD"&&R(),U();break;case"TK_EQUALS":f.var_line&&(f.var_line_tainted=!0),R(),U(),R();break;case"TK_COMMA":if(f.var_line){if($(f.mode)||s==="TK_END_BLOCK")f.var_line_tainted=!1;if(f.var_line_tainted){U(),f.var_line_reindented=!0,f.var_line_tainted=!1,q();break}f.var_line_tainted=!1,U(),R();break}s==="TK_COMMENT"&&q(),s==="TK_END_BLOCK"&&f.mode!=="(EXPRESSION)"?(U(),f.mode==="OBJECT"&&o==="}"?q():R()):f.mode==="OBJECT"?(U(),q()):(U(),R());break;case"TK_OPERATOR":var rt=!0,it=!0;if(Q(o)){R(),U();break}if(i==="*"&&s==="TK_UNKNOWN"&&!u.match(/^\d+$/)){U();break}if(i===":"&&f.in_case){D&&(f.case_body=!0),U(),q(),f.in_case=!1;break}if(i==="::"){U();break}G(i,["--","++","!"])||G(i,["-","+"])&&(G(s,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||G(o,m))?(rt=!1,it=!1,o===";"&&$(f.mode)&&(rt=!0),s==="TK_WORD"&&G(o,m)&&(rt=!0),f.mode==="BLOCK"&&(o==="{"||o===";")&&q()):i==="."?rt=!1:i===":"?f.ternary_depth===0?(f.mode==="BLOCK"&&(f.mode="OBJECT"),rt=!1):f.ternary_depth-=1:i==="?"&&(f.ternary_depth+=1),rt&&R(),U(),it&&R();break;case"TK_BLOCK_COMMENT":var st=F(i),ot;if(K(st.slice(1),"*")){q(),r.push(st[0]);for(ot=1;ot<st.length;ot++)q(),r.push(" "),r.push(j(st[ot]))}else{st.length>1?q():s==="TK_END_BLOCK"?q():R();for(ot=0;ot<st.length;ot++)r.push(st[ot]),r.push("\n")}Y("\n")!=="\n"&&q();break;case"TK_INLINE_COMMENT":R(),U(),$(f.mode)?R():I();break;case"TK_COMMENT":o===","&&!E&&B(!0),s!=="TK_COMMENT"&&(E?q():R()),U(),q();break;case"TK_UNKNOWN":Q(o)&&R(),U()}u=o,s=b,o=i}var ut=T+r.join("").replace(/[\r\n ]+$/,"");return ut}typeof exports!="undefined"&&(exports.js_beautify=js_beautify);